#!/bin/bash

set -e

if [ "$1" = configure ]; then

	INITSYS=$(ls -al /proc/1/exe | awk -F' ' '{print $NF}' | awk -F'/' '{print $NF}')
    ln -s /usr/lib/Digi-Desk2/Digi-Desk2 /usr/bin/Digi-Desk2
	
	if [ "systemd" == "$INITSYS" ]; then

		if [ -e /etc/systemd/system/Digi-Desk2.service ]; then
			rm /etc/systemd/system/Digi-Desk2.service /usr/lib/systemd/system/Digi-Desk2.service /usr/lib/systemd/user/Digi-Desk2.service >/dev/null  2>&1
		fi
		version=$(python3 -V 2>&1 | grep -Po '(?<=Python )(.+)')
		parsedVersion=$(echo "${version//./}")
        mkdir -p /usr/lib/systemd/system/
		cp /usr/share/Digi-Desk2/files/systemd/Digi-Desk2.service /usr/lib/systemd/system/Digi-Desk2.service
		systemctl daemon-reload
		systemctl enable Digi-Desk2
		systemctl start Digi-Desk2
	fi
fi
